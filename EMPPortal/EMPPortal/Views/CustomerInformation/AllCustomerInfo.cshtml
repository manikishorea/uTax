@using EMPPortal.Filters;
@{
    ViewBag.Title = "AllCustomerInfo";
    Layout = "~/Views/Shared/_Layoutab.cshtml";
}
@*@using (Html.BeginForm("LoadData", "CustomerInformation", FormMethod.Post))
    {*@
<input type="hidden" id="Token" value="@Session["Token"]" />
<input type="hidden" id="h_Parameters" />
<input type="hidden" id="formid" name="formid" value="active" formid="siteb303a3e8-1a4f-4638-b31c-50d1b4b8db34" />
<div class="row bank-blk">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-body ">
                <div class="slide-toggle">
                    <h2 class="table-title">Office Management</h2>
                    <button title="Search" class="grid-srch"><i class="fa fa-binoculars" aria-hidden="true"></i></button>
                    <button class="refresh" title="Refresh" style="margin-right:10px;" onclick="fnDisplayClearChild()"><i class="fa fa-refresh" aria-hidden="true"></i></button>
                </div>
                <div class="row cst-filter main-search">
                    <div class="col-md-12 customer-info-top">
                        <div class="col-md-3 no-padding">
                            <span>Search:</span>
                            <input type="text" id="txtSearch" class="form-control">
                        </div>
                        <div class="col-md-9 no-padding-right">
                            <div class="radio radio-primary" style="line-height:70px;padding-top:8px;">
                                <label>
                                    <input type="radio" value="Yes" id="IsCustomerName" name="CustomerSearch" checked="checked"><span class="circle"></span><span class="check"></span>
                                    Company Name
                                </label>
                                <label>
                                    <input type="radio" value="Yes" id="IsUseID" name="CustomerSearch"><span class="circle"></span><span class="check"></span>
                                    User ID
                                </label>
                                <label>
                                    <input type="radio" value="Yes" id="IsEFIN" name="CustomerSearch"><span class="circle"></span><span class="check"></span>
                                    EFIN
                                </label>
                                <label>
                                    <input type="radio" value="Yes" id="IsContactName" name="CustomerSearch"><span class="circle"></span><span class="check"></span>
                                    Contact Name
                                </label>
                                <label>
                                    <input type="radio" value="Yes" id="IsTelephone" name="CustomerSearch"><span class="circle"></span><span class="check"></span>
                                    Telephone Number
                                </label>
                                <label>
                                    <input type="radio" value="Yes" id="IsMasterID" name="CustomerSearch"><span class="circle"></span><span class="check"></span>
                                    Master Identifier
                                </label>
                                <a href="javascript:void(0)" class="btn btn-default filter-btn customer-btn btn-info" onclick="fnDisplayData(0)">Search</a>
                            </div>
                        </div>
                    </div>
                    <div class="multi-select-blk col-md-12">
                        <span class="cst-info-blk">
                            <label>Status</label>
                            <select id="StatusID" class="no-margin-top" name="StatusID" multiple="multiple"></select>
                        </span>
                        <span class="cst-info-blk">
                            <label>Site type</label>
                            <select id="SiteTypeID" class="no-margin-top" name="SiteTypeID" multiple="multiple"></select>
                        </span>
                        <span class="cst-info-blk">
                            <label>Bank Partner</label>
                            <select id="BankPartnerID" class="no-margin-top" name="BankPartnerID" multiple="multiple"></select>
                        </span>
                        <span class="cst-info-blk">
                            <label>Enrollment Status</label>
                            <select id="EnrollmentID" class="no-margin-top" name="EnrollmentID" multiple="multiple"></select>
                        </span>
                        <span class="cst-info-blk">
                            <label>Onboarding Status</label>
                            <select id="OnBoardStatusID" class="no-margin-top" name="OnBoardStatusID" multiple="multiple"></select>
                        </span>
                        <div style="padding-top:38px;">
                            <a href="javascript:void(0)" class="btn btn-default filter-btn btn-info" onclick="fnDisplayData(1)">Apply Filter</a>
                            <a href="javascript:void(0)" class="btn btn-default filter-btn clear-btn btn-info" onclick="fnDisplayClearChild()">Reset</a>
                        </div>
                    </div>
                </div>
                <div class="tbl-overflow">
                    <table id="myTable" class="table table-striped">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th></th>
                                <th>Company</th>
                                @*<th>Parent ID</th>*@
                                <th>
                                    @if (Session["entityid"].ToString() == "1")
                                    {
                                        <span>Master Identifier</span>
                                    }
                                    else { }
                                </th>
                                <th>User ID</th>
                                <th>Contact</th>
                                <th>EFIN</th>
                                <th>Active Bank</th>
                                <th>Bank App Subm.Date</th>
                                <th>Enrollment Status</th>
                                <th>View/Edit Enrollment</th>
                                <th>Total SVB Fee</th>
                                <th>Total Trans Fee</th>
                                <th>On Boarding Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                    </table>
                </div>
                <div class="col-md12">
                    <div class="col-md-6">
                        <h4> Recently Created</h4>
                        <table id="tblCreate" class="table table-striped"></table>
                    </div>
                    <div class="col-md-6">
                        <h4> Recently Updated</h4>
                        <table id="tblUpdate" class="table table-striped"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@*}*@
@*<link href="//cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css" rel="stylesheet" />*@
<link href="~/Content/css/jquery.dataTables.min.css" rel="stylesheet" />

@section Scripts{
    @Html.IncludeVersionedJs("/Scripts/app/common.js")
    @Html.IncludeVersionedJs("/Scripts/app/customerInformation.js")
    @Html.IncludeVersionedJs("/Scripts/app/SearchCustomer.js")
    @Html.IncludeVersionedJs("/Content/js/blockUI.js")
    @*<script src="//cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>*@
    <script src="~/Scripts/jquery.dataTables.min.js"></script>
    <script>
        $(document).ready(function () {
            $.blockUI({ message: '<img src="../content/images/loading-img.gif"/>' });

            LoadGridData($('#UserId').val(), -1);

            $('#myTable tbody').on('click', 'td.details-control a', function () {
                var tr = $(this).closest('td').closest('tr');
                var row = $("#myTable").DataTable().row(tr);
                if (row.child.isShown()) {
                    // This row is already open - close it
                    row.child.hide();
                    tr.removeClass('shown');
                }
                else {
                    // Open this row
                    row.child(format(row.data()["ChildCustomerInfo"])).show();
                    tr.addClass('shown');
                }
                var plus = this.childNodes[0];
                $(plus).toggleClass('fa-plus').toggleClass('fa-minus')

                setTimeout(function () {
                    $("[data-toggle=tooltip]").tooltip();
                }, 1000)
            });

            $('select[name="myTable_length"]').change(function () {
                $.blockUI({ message: '<img src="../content/images/loading-img.gif"/>' });
                //setTimeout(function () {
                //    $("[data-toggle=tooltip]").tooltip();
                //}, 5000);
            })
        });

        function LoadGridData(parameters, type) {

            var table = $("#myTable").
                on('xhr.dt', function (e, settings, json, xhr) {
                    $.unblockUI();
                    setTimeout(function () {
                        if ($('#entityid').val() != $('#Entity_uTax').val()) {
                            $('.details-control a').click();
                        }
                        $("[data-toggle=tooltip]").tooltip();
                    });
                }).DataTable({
                    "processing": false, // for show progress bar
                    "serverSide": true, // for process server side
                    "filter": false, // this is for disable filter (search box)
                    "orderMulti": false, // for disable multiple column at once
                    "ordering": false,
                    "ajax": {
                        "url": "/CustomerInformation/LoadData",
                        "type": "POST",
                        "datatype": "json",
                        //"async":false,
                        "data": { Parameters: parameters, type: type }
                    },
                    "columns": [
                            { "data": "AccountStatus" },
                            {
                                "className": 'details-control',
                                "orderable": false,
                                "data": "ChildInfo",
                                "defaultContent": ''
                            },
                            { "data": "CompanyName" },
                            //{ "data": "str_ParentId" },
                            { "data": "MasterIdentifier" },
                            { "data": "EMPUserId" },
                            {
                                "data": null,
                                "render": function (data, type, full) {
                                    if (full['BusinessOwnerLastName'])
                                        return full['BusinessOwnerLastName'] + ', ' + full['BusinessOwnerFirstName'];
                                    else return '';
                                }
                            },
                            { "data": "EFINStatusText" },
                            {
                                "data": "ActiveBankName",
                                "defaultContent": ''
                            },
                            {
                                "data": "SubmissionDate",
                                "defaultContent": ''
                            },
                            {
                                "data": "EnrollmentStatus",
                                "defaultContent": 'Not Started'
                            },
                            {
                                "data": "",
                                "defaultContent": ''
                            },
                            {
                                "data": "",
                                "defaultContent": ''
                            },
                            {
                                "data": "",
                                "defaultContent": ''
                            },
                            { "data": "OnboardingStatus" },
                            {
                                "orderable": false,
                                "data": "",
                                "defaultContent": ''
                            },
                    ],
                    "columnDefs": [
                                    //Account Status
                                    {
                                        "render": function (data, type, row) {
                                            var content = row.AccountStatus;
                                            if (row.AccountStatus == 'Review') {
                                                content = '<span style="color:red;font-weight:bold;">Review</span>';
                                            }
                                            return content;
                                        },
                                        "targets": 0
                                    },
                                    //Actions
                                    {
                                        // The `data` parameter refers to the data for the cell (defined by the
                                        // `data` option, which defaults to the column being worked with, in
                                        // this case `data: 0`.
                                        "render": function (data, type, row) {
                                            var content = '';
                                            var EntityId = $('#entityid').val();
                                            var IsActivationCompleted = row["IsActivationCompleted"];

                                            $.each(row.Actions, function (item, value) {

                                                if (value.IsParent == 0) {
                                                    content = '<div class="customer-actions" onclick=toggleopen(this,\'' + row.Id + '\')><button class="btn dropdown-toggle">' + value.Name + ' <span class="caret"></span></button><ul id=ul_' + row.Id + ' class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">';
                                                }
                                                else {
                                                    if (value.Name == 'Reset Password') {
                                                        if (_canresetpwd && row.EMPPassword) {
                                                            content += '<li><a href="#" onClick="Resetpassword(\'' + row["Id"] + '\')">Reset Password</a></li>';
                                                        }
                                                    }
                                                    else if (value.Name == 'Add Sub Office' || value.Name == 'Add Additional EFIN') {
                                                        if (_addsuboffice && (IsActivationCompleted == '1' || IsActivationCompleted == 1))
                                                            if (row.EMPPassword)
                                                            content += '<li><a href="/SubSiteOfficeConfiguration/CreateSubSiteInfo?ParentId=' + row["Id"] + '" target="_blank">' + value.Name + '</a></li>';
                                                    }
                                                    else if (value.Name == 'Activate Account' && row["EntityId"] == $('#Entity_SO').val() && (IsActivationCompleted != '1' && IsActivationCompleted != 1)) {
                                                        content += '<li><a href="#" onClick="ActiveAccount(\'' + row["Id"] + '\')">Activate Account</a></li>';
                                                    }
                                                    else if (value.Name == 'View Archive' && $('#entityid').val() == $('#Entity_uTax').val()) {
                                                        if (_archiveInfo) {
                                                            if (row.EntityId == $('#Entity_MO').val() || row.EntityId == $('#Entity_SVB').val()) {
                                                                content += '<li><a href="/Archive/Index?Id=' + row["Id"] + '&entitydisplayid=' + row["BaseEntityId"] + '&entityid=' + row["EntityId"] + '&ptype=config" target="_blank"> View Archive </a>';
                                                            } else {
                                                                content += '<li><a href="/Archive/SubSite?Id=' + row["Id"] + '&ParentId=' + row["ParentId"] + '&entitydisplayid=' + row["BaseEntityId"] + '&entityid=' + row["EntityId"] + '&ptype=config" target="_blank"> View Archive </a>';
                                                            }
                                                        }
                                                    }
                                                }
                                            })
                                            if (content != '')
                                                content += '</ul></div>';

                                            return content;
                                        },
                                        "targets": 14
                                    },
                                    //Enrollment status
                                    {
                                        "render": function (data, type, row) {
                                            var content = '';
                                            var _enrstatus = row.EnrollmentStatus ? row.EnrollmentStatus : "Not Started";
                                            var _rejectedbanks = row.RejectedBanks ? '<span>Rejected Banks:</span><span>' + row.RejectedBanks + '</span>' : '';
                                            var _approvedbank = row.ApprovedBank ? '<span>Approved Bank:</span> <span>' + row.ApprovedBank + '</span>' : '';
                                            //var _unlockedbank = row.UnlockedBanks ? '<span>Unlocked Bank:</span> <span>' + row.UnlockedBanks + '</span>' : '';
                                            var _submittedbank = row.SubmittedBanks ? '<span>Submitted Bank:</span> <span>' + row.SubmittedBanks + '</span>' : '';

                                            _rejectedbanks = row.ApprovedBank ? '<br/>' + _rejectedbanks : _rejectedbanks;
                                            _submittedbank = (row.RejectedBanks || row.ApprovedBank) ? '<br/>' + _submittedbank : _submittedbank;

                                            if (_rejectedbanks || _approvedbank || _submittedbank)
                                                content = '<div data-toggle="tooltip" data-placement="right" data-html="true" title="' + _approvedbank + _rejectedbanks + _submittedbank + '"><b>' + _enrstatus + '</b></div>';
                                            else
                                                content = _enrstatus;
                                            return content;
                                        },
                                        "targets": 9
                                    },
                                    // View/Edit Enrollment icon
                                    {
                                        "render": function (data, type, row) {
                                            
                                            var content = '';

                                            if (!row.CanEnrollmentAllowed) {

                                                content = '';
                                            }
                                            else if ((row.IsActivationCompleted == '1' || row.IsActivationCompleted == 1) && row.AccountStatus=='Review') {
                                                content = '';
                                            }
                                            else {

                                                //if (row.EFIN == '793686') { }
                                                if (row.IsActivationCompleted == 1) {
                                                    var _enrstatus = row.EnrollmentStatus ? row.EnrollmentStatus : "Not Started";
                                                    if (_manageEnroll && ($('#entityid').val() != $('#Entity_MO').val() && $('#entityid').val() != $('#Entity_SVB').val()) && row.IsTaxReturn) {
                                                        if (row.AccountStatus == 'Hold') {
                                                            if (row.Paymentoptions)
                                                                content = '<a href="/' + row.Paymentoptions + '"  target="_blank" data-toggle="tooltip" data-placement="right" data-html="true" title="<span>Status:</span><br> ' + _enrstatus + '"><i class="fa fa-bars"></i></a>';
                                                        }
                                                        else
                                                            content = '<a href="/Enrollment/OfficeInformation?Id=' + row.Id + '&entitydisplayid=' + row["BaseEntityId"] + '&entityid=' + row["EntityId"] + '&ptype=enrollment"  target="_blank" data-toggle="tooltip" data-placement="right" data-html="true" title="<span>Status:</span><br> ' + _enrstatus + '"><i class="fa fa-bars"></i></a>'
                                                    }
                                                    else
                                                        content = '';
                                                }
                                                else
                                                    content = '';
                                            }
                                            return content;
                                        },
                                        "targets": 10
                                    },
                                    //Company name
                                    {
                                        "render": function (data, type, row) {
                                            var content = '';
                                            if ($('#entityid').val() != $('#Entity_MO').val() && $('#entityid').val() != $('#Entity_SVB').val() && $('#entityid').val() != $('#Entity_SO').val() && $('#entityid').val() != $('#Entity_SOME').val()) {

                                                //if (row["EntityId"] == $('#Entity_SVB').val() || row["EntityId"] == $('#Entity_MO').val()) {
                                                if (_canmanageOfc) {
                                                    if (row.EntityId == $('#Entity_MO').val() || row.EntityId == $('#Entity_SVB').val()) {
                                                        content = '<a style="color:#000!important" onclick="fnGetInfo(' + row["Id"] + ')"  href="/Configuration/Dashboard?Id=' + row["Id"] + '&entitydisplayid=' + row["BaseEntityId"] + '&entityid=' + row["EntityId"] + '&ptype=config" target="_blank" data-toggle="tooltip" data-placement="right" data-html="true" title="<span>User Type:</span><br> ' + row["EROType"] + '"><b>' + row["CompanyName"] + '</b></a>';
                                                    } else {
                                                        content = '<a style="color:#000!important" onclick="fnGetInfo(' + row["Id"] + ')"  href="/SubSiteOfficeConfiguration/Dashboard?Id=' + row["Id"] + '&ParentId=' + row["ParentId"] + '&entitydisplayid=' + row["BaseEntityId"] + '&entityid=' + row["EntityId"] + '&ptype=subconfig" target="_blank" data-toggle="tooltip" data-placement="right" data-html="true" title="<span>User Type:</span><br> ' + row["EROType"] + '"><b>' + row["CompanyName"] + '</b></a>';
                                                    }
                                                }
                                                else {
                                                    //content = '<b>' + row["CompanyName"] + '</b><div data-toggle="tooltip" data-placement="right" data-html="true" title="<span>User Type:</span> ' + row["EROType"] + '"></div>';
                                                    content = '<div data-toggle="tooltip" data-placement="right" data-html="true" title="<span>User Type:</span><br> ' + row["EROType"] + '"><b>' + row["CompanyName"] + '</b></div>';
                                                }
                                                //}
                                                //else {
                                                //    content = '<div data-toggle="tooltip" data-placement="bottom" data-html="true" title="<span>User Type:</span><br> ' + row["EROType"] + '"><b>' + row["CompanyName"] + '</b></div>';
                                                //}
                                            }
                                            else {
                                                //content = '<b>' + row["CompanyName"] + '</b><div class="tooltip"><span>User Type:</span> ' + row["EROType"] + '</div>';
                                                content = '<div data-toggle="tooltip" data-placement="right" data-html="true" title="<span>User Type:</span><br> ' + row["EROType"] + '"><b>' + row["CompanyName"] + '</b></div>';
                                            }
                                            return content;
                                        },
                                        "targets": 2
                                    },
                                    //Total SVB Fee
                                    {
                                        "render": function (data, type, row) {
                                            var content = '';

                                            if (row.TotalServiceFee != 0) {
                                                content = '<div data-toggle="tooltip" data-placement="left" data-html="true" title="' + row.ServiceTooltip + '"><b>' + row["TotalServiceFee"] + '</b></div>';
                                            }
                                            return content;
                                        },
                                        "targets": 11
                                    },
                                    //Total Trans Fee
                                    {
                                        "render": function (data, type, row) {
                                            var content = '';

                                            if (row.TotalTransFee != 0) {

                                                content = '<div data-toggle="tooltip" data-placement="left" data-html="true" title="' + row.TransTooltip + '"><b>' + row["TotalTransFee"] + '</b></div>';
                                            }
                                            return content;
                                        },
                                        "targets": 12
                                    },
                                    //EFIN Status Text
                                    {
                                        "render": function (data, type, row) {
                                            return row.EFINStatusText;
                                        },
                                        "targets": 6
                                    },
                                     //UserId/Password
                                    {

                                        "render": function (data, type, row) {
                                            var uip = row.EMPUserId;
                                            if (_showpassword)
                                                uip += '<br/> (' + row.EMPPassword + ')';
                                            return uip;
                                        },
                                        "targets": 4
                                    },
                                    // Onboarding Status
                                    {
                                        "render": function (data, type, row) {
                                            if (row["OnboardingStatus"])
                                                return content = '<div data-toggle="tooltip" data-placement="right" data-html="true" title="' + row["OnboardStatusTooltip"] + '"><b>' + row["OnboardingStatus"] + '</b></div>';
                                            else
                                                return 'Not Started';
                                        },
                                        "targets": 13
                                    },
                                    // Master Identifier
                                    {
                                        "render": function (data, type, row) {
                                            if ($('#entityid').val() == "1")
                                                return row.MasterIdentifier;
                                            else
                                                return '';
                                        },
                                        "targets": 3
                                    }
                    ]
                });

            //setTimeout(function () {
            //    $("[data-toggle=tooltip]").tooltip();

            //}, 1000);
        }

        function fnDisplayData(i) {
            $('#error').hide();
            $.blockUI({ message: '<img src="../content/images/loading-img.gif"/>' });
            var Status = $.trim($('#StatusID').val());
            var SiteType = $.trim($('#SiteTypeID').val());
            var BankPartner = $.trim($('#BankPartnerID').val());
            var Enrollment = $.trim($('#EnrollmentID').val());
            var OnBoard = $.trim($('#OnBoardStatusID').val());

            var SearchType = 0;
            if (i == 0) {
                if ($('#IsCustomerName').is(':checked')) { SearchType = 1; }
                else if ($('#IsUseID').is(':checked')) { SearchType = 2; }
                else if ($('#IsEFIN').is(':checked')) { SearchType = 3; }
                else if ($('#IsContactName').is(':checked')) { SearchType = 4; }
                else if ($('#IsTelephone').is(':checked')) { SearchType = 5; }
                else if ($('#IsMasterID').is(':checked')) { SearchType = 6; }
                if ($('#txtSearch').val().trim() == '') {
                    SearchType = 0;
                    //alert('Please Select any option.');
                }
                Status = '';
                SiteType = '';
                BankPartner = '';
                Enrollment = '';
                OnBoard = '';
            }

            var SearchText = $.trim($('#txtSearch').val());
            if (i == 0 && SearchType == 3) {
                var x = SearchText;
                var regex = /^[0-9]+$/;
                if (!x.match(regex)) {
                    //alert("Must input numbers");
                    $('#error').html('EFIN should be numeric value. Invalid search term specified').show();
                    $.unblockUI();
                    //fnDisplayClearChild();

                    return;
                }
            }


            var entitydisplayid = $('#myentitydisplayid').val();
            var entityid = $('#entityid').val();
            var strvalues = "";
            if (entityid == $('#Entity_uTax').val())
                strvalues = "^" + Status + "^" + SiteType + "^" + BankPartner + "^" + Enrollment + "^" + OnBoard + "^" + $.trim($('#txtSearch').val()) + "^" + SearchType;
            else
                strvalues = $('#UserId').val() + "^" + Status + "^" + SiteType + "^" + BankPartner + "^" + Enrollment + "^" + OnBoard + "^" + $.trim($('#txtSearch').val()) + "^" + SearchType;

            $('#h_Parameters').val(strvalues);
            var table = $('#myTable').DataTable();
            table.destroy();
            LoadGridData(strvalues, i);
        }

        $('#myTable').on('page.dt', function () {
            $.blockUI({ message: '<img src="../content/images/loading-img.gif"/>' });
            //setTimeout(function () {
            //    $("[data-toggle=tooltip]").tooltip();
            //}, 1000)
        });

        function format(d) {
            //var row_s = $("<tr/>").addClass('sub');
            //row_s.appendTo(table);
            //row_s.append($("<td/>"));
            var colcount = 13;
            if ($('#entityid').val() == "1")
                colcount = 14;
            var row_td = $("<td/>").attr("colspan", colcount);
            //row_s.append(row_td);
            var EntityId = $('#entityid').val();
            var table_sub = $('<table/>').addClass('tableData');
            var row_trh = $("<tr class=''/>");
            row_trh.appendTo(table_sub);
            row_trh.append($("<th/>").text("Status"));
            row_trh.append($("<th/>").text(""));
            row_trh.append($("<th/>").html("Company"));
            //row_trh.append($("<th/>").text("Parent ID"));
            if ($('#entityid').val() == "1")
                row_trh.append($("<th/>").text("Master Identifier"));
            row_trh.append($("<th/>").text("User ID"));
            row_trh.append($("<th/>").text("Contact"));
            row_trh.append($("<th/>").text("EFIN"));
            row_trh.append($("<th/>").text("Active Bank"));
            row_trh.append($("<th/>").text("Submission Date"));
            row_trh.append($("<th/>").text("Enr. Status"));
            row_trh.append($("<th/>").text("User Type"));
            row_trh.append($("<th/>").text("View/Edit Enrollment"));
            row_trh.append($("<th/>").text("Service Fee"));
            row_trh.append($("<th/>").text("Transmitter Fee"));
            row_trh.append($("<th/>").text("On Boarding Status"));
            row_trh.append($("<th/>").text("Action"));
            $.each(d, function (r_index, rs) {
                var row_tr = $("<tr/>");
                row_tr.appendTo(table_sub);

                var rStatus = rs.AccountStatus == 'Review' ? '<span style="color:red;font-weight:bold;">Review</span>' : rs.AccountStatus;
                row_tr.append($("<td/>").html(rStatus));
                //if ((rs["IsAdditionalEFINAllowed"] == 'true' || rs["IsAdditionalEFINAllowed"] == 'True' || rs["IsAdditionalEFINAllowed"] == true)) { //&& (rs["IsActivationCompleted"] == 'true' || rs["IsActivationCompleted"] == 'True' || rs["IsActivationCompleted"] == true)
                var childinfo2 = rs["ChildCustomerInfo"];

                if (childinfo2.length > 0) {
                    row_tr.append($("<td/>").addClass("CX").html('<i class="fa fa-plus-square" onclick="fnSubDatadisplay(\'' + rs["Id"] + '\',this)"></i>'));
                } else {
                    row_tr.append($("<td/>"));
                }

                //} else {
                //    row_tr.append($("<td/>"));
                //}

                if (rs["EntityId"] == $('#Entity_SO').val() || rs["EntityId"] == $('#Entity_SOME').val()) {  //|| rs["EntityId"] == $('#Entity_SOME_SS').val()
                    row_tr.append($("<td/>").text(rs.CompanyName));
                }
                else if (_canmanageOfc) {
                    row_tr.append($("<td/>").html('<a href="/SubSiteOfficeConfiguration/Dashboard?Id=' + rs["Id"] + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs["BaseEntityId"] + '&entityid=' + rs["EntityId"] + '&ptype=subconfig" target="_blank">' + rs["CompanyName"] + '</a>'));
                } else {
                    row_tr.append($("<td/>").text(rs.CompanyName));
                }

                //row_tr.append($("<td/>").text(rs["str_ParentId"]));
                if ($('#entityid').val() == "1")
                    row_tr.append($("<td/>").text(rs["MasterIdentifier"]));
                if (_showpassword)
                    row_tr.append($("<td/>").html(rs["EMPUserId"] + " <br/> (" + rs["EMPPassword"] + ")"));
                else
                    row_tr.append($("<td/>").html(rs["EMPUserId"]));
                row_tr.append($("<td/>").text(rs["BusinessOwnerLastName"] ? (rs["BusinessOwnerLastName"] + ', ' + rs["BusinessOwnerFirstName"]) : ''));
                row_tr.append($("<td/>").html(rs["EFINStatusText"]));

                row_tr.append($("<td/>").text(rs.ActiveBankName ? rs.ActiveBankName : ''));
                row_tr.append($("<td/>").text(rs.SubmissionDate ? rs.SubmissionDate : ''));

                var _childenrstatus = rs.EnrollmentStatus ? rs.EnrollmentStatus : "Not Started";
                var _childrejectedbanks = rs.RejectedBanks ? '<span>Rejected Banks:</span><span>' + rs.RejectedBanks + '</span>' : '';
                var _childapprovedbank = rs.ApprovedBank ? '<span>Approved Banks:</span> <span>' + rs.ApprovedBank + '</span>' : '';
                //var _childunlockedbank = rs.UnlockedBanks ? '<span>Unlocked Bank:</span> <span>' + rs.UnlockedBanks + '</span>' : '';
                var _childsubbank = rs.SubmittedBanks ? '<span>Submitted Banks:</span> <span>' + rs.SubmittedBanks + '</span>' : '';
                var statushtml = '';

                _childrejectedbanks = rs.ApprovedBank ? '<br/>' + _childrejectedbanks : _childrejectedbanks;
                _childsubbank = (rs.RejectedBanks || rs.ApprovedBank) ? '<br/>' + _childsubbank : _childsubbank;

                if (_childrejectedbanks || _childapprovedbank || _childsubbank)
                    statushtml = '<div data-toggle="tooltip" data-placement="right" data-html="true" title="' + _childapprovedbank + _childrejectedbanks + _childsubbank + '"><b>' + _childenrstatus + '</b></div>';
                else
                    statushtml = _childenrstatus;

                row_tr.append($("<td/>").html(statushtml));
                row_tr.append($("<td/>").text(rs["EROType"]));
                if (rs.IsActivationCompleted == 1 && _manageEnroll) {

                    if (rs.CanEnrollmentAllowedForMain) {
                        //if ((rs.CanEnrollmentAllowed) && EntityId == $('#Entity_uTax').val()) {
                        //    row_tr.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs.Id + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs["BaseEntityId"] + '&entityid=' + rs["EntityId"] + '&ptype=enrollment" target="_blank" data-toggle="tooltip" data-placement="bottom" data-html="true" title="<span>Status:</span> ' + _childenrstatus + '"><i class="fa fa-bars"></i></a>'));
                        //}
                        //else if (EntityId != $('#Entity_uTax').val()) {
                        //    row_tr.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs.Id + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs["BaseEntityId"] + '&entityid=' + rs["EntityId"] + '&ptype=enrollment" target="_blank" data-toggle="tooltip" data-placement="bottom" data-html="true" title="<span>Status:</span> ' + _childenrstatus + '"><i class="fa fa-bars"></i></a>'));
                        //}
                        //else
                        //    row_tr.append($("<td/>").html('<i class="fa fa-bars" title=""></i>'));
                        if ((rs.IsActivationCompleted == '1' || rs.IsActivationCompleted == 1) && rs.AccountStatus == 'Review') {
                            row_tr.append($("<td/>").html(''));
                        }
                        else
                        row_tr.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs.Id + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs["BaseEntityId"] + '&entityid=' + rs["EntityId"] + '&ptype=enrollment" target="_blank" data-toggle="tooltip" data-placement="right" data-html="true" title="<span>Status:</span> ' + _childenrstatus + '"><i class="fa fa-bars"></i></a>'));

                    }
                    else
                        row_tr.append($("<td/>").html(''));


                    //if ((rs.CanEnrollmentAllowed && EntityId == $('#Entity_uTax').val())) {
                    //    row_tr.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs.Id + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs["BaseEntityId"] + '&entityid=' + rs["EntityId"] + '&ptype=enrollment" target="_blank" data-toggle="tooltip" data-placement="bottom" data-html="true" title="<span>Status:</span> ' + _childenrstatus + '"><i class="fa fa-bars"></i></a>'));
                    //}
                    //else if (rs.CanEnrollmentAllowedForMain && EntityId != $('#Entity_uTax').val()) {
                    //    row_tr.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs.Id + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs["BaseEntityId"] + '&entityid=' + rs["EntityId"] + '&ptype=enrollment" target="_blank" data-toggle="tooltip" data-placement="bottom" data-html="true" title="<span>Status:</span> ' + _childenrstatus + '"><i class="fa fa-bars"></i></a>'));
                    //}
                    //else if (EntityId == $('#Entity_uTax').val() && rs.CanEnrollmentAllowedForMain) {
                    //    row_tr.append($("<td/>").html('<i class="fa fa-bars" title=""></i>'));
                    //}
                    //else if (EntityId != $('#Entity_uTax').val() && rs.CanEnrollmentAllowed) {
                    //    row_tr.append($("<td/>").html('<i class="fa fa-bars" title=""></i>'));
                    //}
                    //else if (rs.EntityId == $('#Entity_SOME_SS').val()) {
                    //    row_tr.append($("<td/>").html(''));
                    //}
                    //else
                    //{
                    //    row_tr.append($("<td/>").html(''));
                    //}

                }
                else {
                    row_tr.append($("<td/>").html(''));
                }

                if (rs["TotalServiceFee"] != '' && rs["TotalServiceFee"] != '0') {
                    // row_tr.append($("<td/>").html('' + rs["TotalServiceFee"] + '<span>Service Bureau Fee Summary:</span>' + rs["ServiceTooltip"] + '</div></div>'));
                    row_tr.append($("<td/>").html('<div data-toggle="tooltip" data-placement="left" data-html="true" title="<span>Service Bureau Fee Summary:</span><br> ' + rs["ServiceTooltip"] + '"><b>' + rs["TotalServiceFee"] + '</b></div>'));
                } else {
                    row_tr.append($("<td/>").html(rs["TotalServiceFee"]));
                }
                if (rs["TotalTransFee"] != '' && rs["TotalTransFee"] != '0') {
                    //row_tr.append($("<td/>").html('<div class="hover"><span class="hover-blk">' + rs["TotalTransFee"] + '</span><div class="tooltip"> <span>Transmission Fee Summary:</span> ' + rs["TransTooltip"] + '</div></div>'));
                    row_tr.append($("<td/>").html('<div data-toggle="tooltip" data-placement="left" data-html="true" title="<span>Service Bureau Fee Summary:</span><br> ' + rs["TransTooltip"] + '"><b>' + rs["TotalTransFee"] + '</b></div>'));
                }
                else {
                    row_tr.append($("<td/>").html(rs["TotalTransFee"]));
                }

                if (rs["OnboardingStatus"])
                    row_tr.append($("<td/>").html('<div data-toggle="tooltip" data-placement="right" data-html="true" title="' + rs["OnboardStatusTooltip"] + '"><b>' + rs["OnboardingStatus"] + '</b></div>'));
                else
                    row_tr.append($("<td/>").text('Not Started'));



                var content = '';
                $.each(rs.Actions, function (item, value) {

                    if (value.IsParent == 0) {
                        content = '<div class="customer-actions" onclick=toggleopen(this)><button class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">' + value.Name + ' <span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu">';
                    }
                    else {

                        if (value.Name == 'Reset Password') {
                            if (_canresetpwd && rs.EMPPassword) {
                                content += '<li><a href="#" onClick="Resetpassword(\'' + rs["Id"] + '\')">Reset Password</a></li>';
                            }
                        }
                        else if (value.Name == 'Add Sub Office' || value.Name == 'Add Additional EFIN') {
                            if (_addsuboffice && (rs["IsActivationCompleted"] == 'true' || rs["IsActivationCompleted"] == 'True' || rs["IsActivationCompleted"] == true))
                                if (rs.EMPPassword)
                                content += '<li><a href="/SubSiteOfficeConfiguration/CreateSubSiteInfo?ParentId=' + rs["Id"] + '" target="_blank">' + value.Name + '</a></li>';
                        }
                        else if (value.Name == 'Activate Account' && rs["EntityId"] == $('#Entity_SO').val() && (rs["IsActivationCompleted"] != 'true' && rs["IsActivationCompleted"] != 'True' && rs["IsActivationCompleted"] != true)) {
                            content += '<li><a href="#" onClick="ActiveAccount(\'' + rs["Id"] + '\')">Activate Account</a></li>';
                        }
                        else if (value.Name == 'View Archive') {

                            if (_archiveInfo) {
                                content += '<li><a href="/Archive/SubSite?Id=' + rs["Id"] + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs["BaseEntityId"] + '&entityid=' + rs["EntityId"] + '&ptype=config" target="_blank"> View Archive </a>';
                            }
                        }
                    }
                })
                if (content != '')
                    content += '</ul></div>';

                row_tr.append($("<td/>").html(content));


                //if ((rs["IsAdditionalEFINAllowed"] == 'true' || rs["IsAdditionalEFINAllowed"] == 'True' || rs["IsAdditionalEFINAllowed"] == true) && (rs["IsActivationCompleted"] == 'true' || rs["IsActivationCompleted"] == 'True' || rs["IsActivationCompleted"] == true)) {
                //    row_tr.append($("<td/>").html('<div class="btn-group dropleft" onclick=toggleopen(this)><button class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Actions <span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu"><li><a href="#" onClick="Resetpassword(\'' + rs["Id"] + '\')">Reset Password</a></li><li><a href="/SubSiteOfficeConfiguration/CreateSubSiteInfo?ParentId=' + rs["Id"] + '" target="_blank">Add Sub Office</a></li></ul></div>'));
                //} else {
                //    row_tr.append($("<td/>").html('<div class="btn-group dropleft" onclick=toggleopen(this)><button class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Actions <span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu"><li><a href="#" onClick="Resetpassword(\'' + rs["Id"] + '\')">Reset Password</a></li></ul></div>'));
                //}

                //if ((rs["IsAdditionalEFINAllowed"] == 'true' || rs["IsAdditionalEFINAllowed"] == 'True' || rs["IsAdditionalEFINAllowed"] == true)) { //&& (rs["IsActivationCompleted"] == 'true' || rs["IsActivationCompleted"] == 'True' || rs["IsActivationCompleted"] == true)
                //var childinfo2 = rs["ChildCustomerInfo"];
                if (childinfo2.length > 0) {
                    var row_s2 = $("<tr id=" + rs["Id"] + " style='display:none;'/>").addClass('sub');
                    row_s2.appendTo(table_sub);
                    //row_s2.append($("<td/>"));
                    var colcount2 = 15;
                    if ($('#entityid').val() == "1")
                        colcount2 = 16;

                    var row_td2 = $("<td/>").attr("colspan", colcount2);
                    row_s2.append(row_td2);
                    var table_sub2 = $('<table/>').addClass('tableData table_SOMESubSite');
                    var row_trh2 = $("<tr class=''/>");
                    row_trh2.appendTo(table_sub2);
                    row_trh2.append($("<th/>").text("Status"));
                    row_trh2.append($("<th/>").text(""));
                    row_trh2.append($("<th/>").text("Company"));
                    row_trh2.append($("<th/>").text("Parent ID"));
                    if ($('#entityid').val() == "1")
                        row_trh2.append($("<th/>").text("Master Identifier"));
                    row_trh2.append($("<th/>").text("User ID"));
                    row_trh2.append($("<th/>").text("Contact"));
                    row_trh2.append($("<th/>").text("EFIN"));
                    row_trh2.append($("<th/>").text("Active Bank"));
                    row_trh2.append($("<th/>").text("Submission Date"));
                    row_trh2.append($("<th/>").text("Enr. Status"));
                    row_trh2.append($("<th/>").text("User Type"));
                    row_trh2.append($("<th/>").text("View/Edit Enrollment"));
                    row_trh2.append($("<th/>").text("Service Fee"));
                    row_trh2.append($("<th/>").text("Transmitter Fee"));
                    row_trh2.append($("<th/>").text("On Boarding Status"));
                    row_trh2.append($("<th/>").text("Action"));
                    $.each(childinfo2, function (r_index2, rs2) {
                        var row_tr2 = $("<tr/>");
                        row_tr2.appendTo(table_sub2);

                        var rStatus2 = rs2.AccountStatus == 'Review' ? '<span style="color:red;font-weight:bold;">Review</span>' : rs2.AccountStatus;
                        row_tr2.append($("<td/>").html(rStatus2));
                        var childinfo3 = rs2["ChildCustomerInfo"];

                        if (childinfo3.length > 0) {
                            row_tr2.append($("<td/>").addClass("CX").html('<i class="fa fa-plus-square" onclick="fnSubDatadisplay(\'' + rs2["Id"] + '\',this)"></i>'));
                        } else {
                            row_tr2.append($("<td/>"));
                        }

                        if (rs2["EntityId"] == $('#Entity_SO').val() || rs2["EntityId"] == $('#Entity_SOME').val() || rs2["EntityId"] == $('#Entity_SOME_SS').val()) {
                            row_tr2.append($("<td/>").html(rs2["CompanyName"]));
                        }
                        else {
                            row_tr2.append($("<td/>").html('<a href="/SubSiteOfficeConfiguration/Dashboard?Id=' + rs2["Id"] + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs2["BaseEntityId"] + '&entityid=' + rs2["EntityId"] + '&ptype=subconfig" target="_blank">' + rs2["CompanyName"] + '</a>'));
                        }

                        row_tr2.append($("<td/>").text(rs2["str_ParentId"]));
                        if ($('#entityid').val() == "1")
                            row_tr2.append($("<td/>").text(rs2["MasterIdentifier"]));
                        if (_showpassword)
                            row_tr2.append($("<td/>").html(rs2["EMPUserId"] + " <br/> (" + rs2["EMPPassword"] + ")"));
                        else
                            row_tr2.append($("<td/>").html(rs2["EMPUserId"]));
                        row_tr2.append($("<td/>").text(rs2["BusinessOwnerLastName"] ? (rs2["BusinessOwnerLastName"] + ', ' + rs2["BusinessOwnerFirstName"]) : ''));
                        row_tr2.append($("<td/>").html(rs2["EFINStatusText"]));
                        row_tr2.append($("<td/>").text(rs2.ActiveBankName ? rs2.ActiveBankName : ''));
                        row_tr2.append($("<td/>").text(rs2.SubmissionDate ? rs2.SubmissionDate : ''));

                        var _childenrstatus_2 = rs2.EnrollmentStatus ? rs2.EnrollmentStatus : "Not Started";
                        var _childrejectedbanks_2 = rs2.RejectedBanks ? '<span>Rejected Banks:</span><span>' + rs2.RejectedBanks + '</span>' : '';
                        var _childapprovedbank_2 = rs2.ApprovedBank ? '<span>Approved Bank:</span> <span>' + rs2.ApprovedBank + '</span>' : '';
                        //var _childunlockedbank_2 = rs2.UnlockedBanks ? '<span>Unlocked Bank:</span> <span>' + rs2.UnlockedBanks + '</span>' : '';
                        var _childsubbank_2 = rs2.SubmittedBanks ? '<span>Submitted Banks:</span> <span>' + rs2.SubmittedBanks + '</span>' : '';
                        var statushtml_2 = '';

                        _childrejectedbanks_2 = rs2.ApprovedBank ? '<br/>' + _childrejectedbanks_2 : _childrejectedbanks_2;
                        _childsubbank_2 = (rs2.RejectedBanks || rs2.ApprovedBank) ? '<br/>' + _childsubbank_2 : _childsubbank_2;

                        if (_childrejectedbanks_2 || _childapprovedbank_2 || _childsubbank_2)
                            statushtml_2 = '<div data-toggle="tooltip" data-placement="right" data-html="true" title="' + _childapprovedbank_2 + _childrejectedbanks_2 + _childsubbank_2 + '"><b>' + _childenrstatus_2 + '</b></div>';
                        else
                            statushtml_2 = _childenrstatus_2;

                        row_tr2.append($("<td/>").html(statushtml_2));
                        row_tr2.append($("<td/>").text(rs2["EROType"]));
                        // row_tr2.append($("<td/>").text(rs2["TotalServiceFee"]));
                        // row_tr2.append($("<td/>").text(rs2["TotalTransFee"]));
                        // row_tr2.append($("<td/>").html('<span class="cst-tooltip"><a href="#" data-toggle="tooltip" data-placement="left"  data-original-title="' + rs2["ServiceTooltip"] + '">' + rs2["TotalServiceFee"] + '</a></span>'));
                        //row_tr2.append($("<td/>").html('<span class="cst-tooltip"><a href="#" data-toggle="tooltip" data-placement="left"  data-original-title="' + rs2["TransTooltip"] + '">' + rs2["TotalTransFee"] + '</a></span>'));
                        ////if (!rs2.IsActivationCompleted) {
                        ////    row_tr2.append($("<td/>").html(''));
                        ////}
                        ////else {
                        ////    if (_manageEnroll)
                        ////        row_tr2.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs2.Id + '&ParentId=' + rs.ParentId + '&entitydisplayid=' + rs2["BaseEntityId"] + '&entityid=' + rs2["EntityId"] + '" target="_blank"><i class="fa fa-bars"></i></a>'));
                        ////    else
                        ////        row_tr2.append($("<td/>").html(''));
                        ////}

                        if (rs2.IsActivationCompleted == 1 && _manageEnroll) {

                            if (rs2.CanEnrollmentAllowedForMain) {
                                // if ((rs2.CanEnrollmentAllowed)) {
                                if ((rs2.IsActivationCompleted == '1' || rs2.IsActivationCompleted == 1) && rs2.AccountStatus == 'Review') {
                                    row_tr2.append($("<td/>").html(''));
                                }
                                else
                                row_tr2.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs2.Id + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs2["BaseEntityId"] + '&entityid=' + rs2["EntityId"] + '&ptype=enrollment" target="_blank" data-toggle="tooltip" data-placement="right" data-html="true" title="<span>Status:</span> ' + _childenrstatus_2 + '"><i class="fa fa-bars"></i></a>'));
                                //}
                                //else
                                //    row_tr2.append($("<td/>").html('<i class="fa fa-bars" title=""></i>'));
                            }
                            else
                                row_tr2.append($("<td/>").html(''));


                            //if (rs2.CanEnrollmentAllowedForMain && EntityId != $('#Entity_uTax').val()) {
                            //    row_tr2.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs2.Id + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs2["BaseEntityId"] + '&entityid=' + rs2["EntityId"] + '&ptype=enrollment" target="_blank" data-toggle="tooltip" data-placement="bottom" data-html="true" title="<span>Status:</span> ' + _childenrstatus_2 + '"><i class="fa fa-bars"></i></a>'));
                            //}
                            //else if (rs2.CanEnrollmentAllowed && EntityId == $('#Entity_uTax').val()) {
                            //    row_tr2.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs2.Id + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs2["BaseEntityId"] + '&entityid=' + rs2["EntityId"] + '&ptype=enrollment" target="_blank" data-toggle="tooltip" data-placement="bottom" data-html="true" title="<span>Status:</span> ' + _childenrstatus_2 + '"><i class="fa fa-bars"></i></a>'));
                            //}
                            //else if (EntityId == $('#Entity_uTax').val() && rs2.CanEnrollmentAllowedForMain) {
                            //    row_tr2.append($("<td/>").html('<i class="fa fa-bars" title=""></i>'));
                            //}
                            //else if (EntityId != $('#Entity_uTax').val() && rs2.CanEnrollmentAllowed) {
                            //    row_tr2.append($("<td/>").html('<i class="fa fa-bars" title=""></i>'));
                            //}
                            //else if (rs2.EntityId == $('#Entity_SOME_SS').val()) {
                            //    row_tr2.append($("<td/>").html(''));
                            //}
                            //else {
                            //    row_tr2.append($("<td/>").html(''));
                            //}
                        }
                        else {
                            row_tr2.append($("<td/>").html(''));
                        }

                        if (rs2["TotalServiceFee"] != '' && rs2["TotalServiceFee"] != '0') {
                            row_tr2.append($("<td/>").html('<div data-toggle="tooltip" data-placement="left" data-html="true" title="<span>Service Bureau Fee Summary:</span><br> ' + rs2["ServiceTooltip"] + '"><b>' + rs2["TotalServiceFee"] + '</b></div>'));
                        } else {
                            row_tr2.append($("<td/>").html(rs2["TotalServiceFee"]));
                        }

                        if (rs2["TotalTransFee"] != '' && rs2["TotalTransFee"] != '0') {
                            row_tr2.append($("<td/>").html('<div data-toggle="tooltip" data-placement="left" data-html="true" title="<span>Service Bureau Fee Summary:</span><br> ' + rs2["TransTooltip"] + '"><b>' + rs2["TotalTransFee"] + '</b></div>'));
                        }
                        else {
                            row_tr2.append($("<td/>").html(rs2["TotalTransFee"]));
                        }

                        if (rs2["OnboardingStatus"])
                            row_tr2.append($("<td/>").html('<div data-toggle="tooltip" data-placement="right" data-html="true" title="' + rs2["OnboardStatusTooltip"] + '"><b>' + rs2["OnboardingStatus"] + '</b></div>'));
                        else
                            row_tr2.append($("<td/>").text('Not Started'));

                        var content1 = '';
                        $.each(rs2.Actions, function (item, value) {

                            if (value.IsParent == 0) {
                                content1 = '<div class="customer-actions" onclick=toggleopen(this)><button class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">' + value.Name + ' <span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu">';
                            }
                            else {
                                if (value.Name == 'Reset Password') {
                                    if (_canresetpwd && rs2.EMPPassword) {
                                        content1 += '<li><a href="#" onClick="Resetpassword(\'' + rs2["Id"] + '\')">Reset Password</a></li>';
                                    }
                                }
                                else if (value.Name == 'Add Sub Office' || value.Name == 'Add Additional EFIN') {
                                    if (_addsuboffice && (rs2["IsActivationCompleted"] == 'true' || rs2["IsActivationCompleted"] == 'True' || rs2["IsActivationCompleted"] == true))
                                        if (rs2.EMPPassword)
                                        content1 += '<li><a href="/SubSiteOfficeConfiguration/CreateSubSiteInfo?ParentId=' + rs2["Id"] + '" target="_blank">' + value.Name + '</a></li>';
                                }
                                else if (value.Name == 'Activate Account' && rs2["EntityId"] == $('#Entity_SO').val() && (rs2["IsActivationCompleted"] != 'true' && rs2["IsActivationCompleted"] != 'True' && rs2["IsActivationCompleted"] != true)) {
                                    content1 += '<li><a href="#" onClick="ActiveAccount(\'' + rs2["Id"] + '\')">Activate Account</a></li>';
                                }
                                else if (value.Name == 'View Archive') {

                                    if (_archiveInfo) {
                                        content1 += '<li><a href="/Archive/SubSite?Id=' + rs2["Id"] + '&ParentId=' + rs2["ParentId"] + '&entitydisplayid=' + rs2["BaseEntityId"] + '&entityid=' + rs2["EntityId"] + '&ptype=config" target="_blank"> View Archive </a>';
                                    }
                                }
                            }
                        })
                        if (content1 != '')
                            content1 += '</ul></div>';

                        row_tr2.append($("<td/>").html(content1));


                        if (childinfo3.length > 0) {
                            var row_s3 = $("<tr id=" + rs2["Id"] + " style='display:none;'/>").addClass('sub');
                            row_s3.appendTo(table_sub2);
                            //row_s2.append($("<td/>"));
                            var colcount3 = 18;
                            if ($('#entityid').val() == "1")
                                colcount3 = 19;

                            var row_td3 = $("<td/>").attr("colspan", 18);
                            row_s3.append(row_td3);
                            var table_sub3 = $('<table/>').addClass('tableData table_SOMESubSite');
                            var row_trh3 = $("<tr class=''/>");
                            row_trh3.appendTo(table_sub3);
                            row_trh3.append($("<th/>").text("Status"));
                            row_trh3.append($("<th/>").text("Company"));
                            row_trh3.append($("<th/>").text("Parent ID"));
                            if ($('#entityid').val() == "1")
                                row_trh3.append($("<th/>").text("Master Identifier"));
                            row_trh3.append($("<th/>").text("User ID"));
                            row_trh3.append($("<th/>").text("Contact"));
                            row_trh3.append($("<th/>").text("EFIN"));
                            row_trh3.append($("<th/>").text("Active Bank"));
                            row_trh3.append($("<th/>").text("Submission Date"));
                            row_trh3.append($("<th/>").text("Enr. Status"));
                            row_trh3.append($("<th/>").text("User Type"));
                            row_trh3.append($("<th/>").text("View/Edit Enrollment"));
                            row_trh3.append($("<th/>").text("Service Fee"));
                            row_trh3.append($("<th/>").text("Transmitter Fee"));
                            row_trh3.append($("<th/>").text("On Boarding Status"));
                            row_trh3.append($("<th/>").text("Action"));
                            $.each(childinfo3, function (r_index3, rs3) {
                                var row_tr3 = $("<tr/>");
                                row_tr3.appendTo(table_sub3);

                                var rStatus3 = rs3.AccountStatus == 'Review' ? '<span style="color:red;font-weight:bold;">Review</span>' : rs3.AccountStatus;
                                row_tr3.append($("<td/>").html(rStatus3));

                                //if (rs3["EntityId"] == $('#Entity_SO_SOME').val()) {
                                row_tr3.append($("<td/>").html('<a href="/SubSiteOfficeConfiguration/Dashboard?Id=' + rs3["Id"] + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs3["BaseEntityId"] + '&entityid=' + rs3["EntityId"] + '&ptype=subconfig" target="_blank">' + rs3["CompanyName"] + '</a>'));
                                //} else
                                //{
                                //    row_tr3.append($("<td/>").html(rs3["CompanyName"]));
                                //}

                                row_tr3.append($("<td/>").text(rs3["str_ParentId"]));
                                if ($('#entityid').val() == "1")
                                    row_tr3.append($("<td/>").text(rs3["MasterIdentifier"]));
                                if (_showpassword)
                                    row_tr3.append($("<td/>").html(rs3["EMPUserId"] + "<br/> (" + rs3["EMPPassword"] + ")"));
                                else
                                    row_tr3.append($("<td/>").html(rs3["EMPUserId"]));
                                row_tr3.append($("<td/>").text(rs3["BusinessOwnerLastName"] ? (rs3["BusinessOwnerLastName"] + ', ' + rs3["BusinessOwnerFirstName"]) : ''));
                                row_tr3.append($("<td/>").html(rs3["EFINStatusText"]));
                                row_tr3.append($("<td/>").text(rs3.ActiveBankName ? rs3.ActiveBankName : ''));
                                row_tr3.append($("<td/>").text(rs3.SubmissionDate ? rs3.SubmissionDate : ''));

                                var _childenrstatus_3 = rs3.EnrollmentStatus ? rs3.EnrollmentStatus : "Not Started";
                                var _childrejectedbanks_3 = rs3.RejectedBanks ? '<span>Rejected Banks:</span><span>' + rs3.RejectedBanks + '</span>' : '';
                                var _childapprovedbank_3 = rs3.ApprovedBank ? '<span>Approved Bank:</span> <span>' + rs3.ApprovedBank + '</span>' : '';
                                var _childunlockedbank_3 = rs3.UnlockedBanks ? '<span>Unlocked Bank:</span> <span>' + rs3.UnlockedBanks + '</span>' : '';
                                var _childsubbank_3 = rs3.SubmittedBanks ? '<span>Submitted Banks:</span> <span>' + rs3.SubmittedBanks + '</span>' : '';
                                var statushtml_3 = '';

                                _childrejectedbanks_3 = rs3.ApprovedBank ? '<br/>' + _childrejectedbanks_3 : _childrejectedbanks_3;
                                _childsubbank_3 = (rs3.RejectedBanks || rs3.ApprovedBank) ? '<br/>' + _childsubbank_3 : _childsubbank_3;

                                if (_childrejectedbanks_3 || _childapprovedbank_3 || _childsubbank_3)
                                    statushtml_3 = '<div data-toggle="tooltip" data-placement="right" data-html="true" title="' + _childapprovedbank_3 + _childrejectedbanks_3 + _childsubbank_3 + '"><b>' + _childenrstatus_3 + '</b></div>';
                                else
                                    statushtml_3 = _childenrstatus_3;

                                row_tr3.append($("<td/>").html(statushtml_3));
                                row_tr3.append($("<td/>").text(rs3["EROType"]));
                                // row_tr2.append($("<td/>").text(rs2["TotalServiceFee"]));
                                // row_tr2.append($("<td/>").text(rs2["TotalTransFee"]));
                                // row_tr2.append($("<td/>").html('<span class="cst-tooltip"><a href="#" data-toggle="tooltip" data-placement="left"  data-original-title="' + rs2["ServiceTooltip"] + '">' + rs2["TotalServiceFee"] + '</a></span>'));
                                //row_tr2.append($("<td/>").html('<span class="cst-tooltip"><a href="#" data-toggle="tooltip" data-placement="left"  data-original-title="' + rs2["TransTooltip"] + '">' + rs2["TotalTransFee"] + '</a></span>'));
                                ////if (!rs2.IsActivationCompleted) {
                                ////    row_tr2.append($("<td/>").html(''));
                                ////}
                                ////else {
                                ////    if (_manageEnroll)
                                ////        row_tr2.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs2.Id + '&ParentId=' + rs.ParentId + '&entitydisplayid=' + rs2["BaseEntityId"] + '&entityid=' + rs2["EntityId"] + '" target="_blank"><i class="fa fa-bars"></i></a>'));
                                ////    else
                                ////        row_tr2.append($("<td/>").html(''));
                                ////}

                                if (rs3.IsActivationCompleted == 1 && _manageEnroll) {

                                    if (rs3.CanEnrollmentAllowedForMain) {
                                        // if ((rs3.CanEnrollmentAllowed)) {
                                        if ((rs3.IsActivationCompleted == '1' || rs3.IsActivationCompleted == 1) && rs3.AccountStatus == 'Review') {
                                            row_tr3.append($("<td/>").html(''));
                                        }
                                        else
                                        row_tr3.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs3.Id + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs3["BaseEntityId"] + '&entityid=' + rs3["EntityId"] + '&ptype=enrollment" target="_blank" data-toggle="tooltip" data-placement="right" data-html="true" title="<span>Status:</span> ' + _childenrstatus_3 + '"><i class="fa fa-bars"></i></a>'));
                                        //}
                                        //else
                                        //    row_tr3.append($("<td/>").html('<i class="fa fa-bars" title=""></i>'));
                                    }
                                    else
                                        row_tr3.append($("<td/>").html(''));

                                    //if (rs3.CanEnrollmentAllowedForMain && EntityId != $('#Entity_uTax').val()) {
                                    //    row_tr3.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs3.Id + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs3["BaseEntityId"] + '&entityid=' + rs3["EntityId"] + '&ptype=enrollment" target="_blank" data-toggle="tooltip" data-placement="right" data-html="true" title="<span>Status:</span> ' + _childenrstatus_3 + '"><i class="fa fa-bars"></i></a>'));
                                    //}
                                    //else if (rs3.CanEnrollmentAllowed && EntityId == $('#Entity_uTax').val()) {
                                    //    row_tr3.append($("<td/>").html('<a href="/Enrollment/OfficeInformation?Id=' + rs3.Id + '&ParentId=' + rs["ParentId"] + '&entitydisplayid=' + rs3["BaseEntityId"] + '&entityid=' + rs3["EntityId"] + '&ptype=enrollment" target="_blank" data-toggle="tooltip" data-placement="right" data-html="true" title="<span>Status:</span> ' + _childenrstatus_3 + '"><i class="fa fa-bars"></i></a>'));
                                    //}
                                    //else if (EntityId == $('#Entity_uTax').val() && rs3.CanEnrollmentAllowedForMain) {
                                    //    row_tr3.append($("<td/>").html('<i class="fa fa-bars" title=""></i>'));
                                    //}
                                    //else if (EntityId != $('#Entity_uTax').val() && rs3.CanEnrollmentAllowed) {
                                    //    row_tr3.append($("<td/>").html('<i class="fa fa-bars" title=""></i>'));
                                    //}
                                    //else if (rs3.EntityId == $('#Entity_SOME_SS').val()) {
                                    //    row_tr3.append($("<td/>").html(''));
                                    //}
                                    //else {
                                    //    row_tr3.append($("<td/>").html(''));
                                    //}
                                }
                                else {
                                    row_tr3.append($("<td/>").html(''));
                                }

                                if (rs3["TotalServiceFee"] != '' && rs3["TotalServiceFee"] != '0') {
                                    row_tr3.append($("<td/>").html('<div data-toggle="tooltip" data-placement="left" data-html="true" title="<span>Service Bureau Fee Summary:</span><br> ' + rs3["ServiceTooltip"] + '"><b>' + rs3["TotalServiceFee"] + '</b></div>'));
                                } else {
                                    row_tr3.append($("<td/>").html(rs3["TotalServiceFee"]));
                                }
                                if (rs3["TotalTransFee"] != '' && rs3["TotalTransFee"] != '0') {
                                    row_tr3.append($("<td/>").html('<div data-toggle="tooltip" data-placement="left" data-html="true" title="<span>Service Bureau Fee Summary:</span><br> ' + rs3["TransTooltip"] + '"><b>' + rs3["TotalTransFee"] + '</b></div>'));
                                }
                                else {
                                    row_tr3.append($("<td/>").html(rs3["TotalTransFee"]));
                                }

                                if (rs3["OnboardingStatus"])
                                    row_tr3.append($("<td/>").html('<div data-toggle="tooltip" data-placement="right" data-html="true" title="' + rs3["OnboardStatusTooltip"] + '"><b>' + rs3["OnboardingStatus"] + '</b></div>'));
                                else
                                    row_tr3.append($("<td/>").text('Not Started'));

                                var content2 = '';
                                $.each(rs3.Actions, function (item, value) {

                                    if (value.IsParent == 0) {
                                        content2 = '<div class="customer-actions" onclick=toggleopen(this)><button class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">' + value.Name + ' <span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu">';
                                    }
                                    else {
                                        if (value.Name == 'Reset Password') {
                                            if (_canresetpwd && rs3.EMPPassword) {
                                                content2 += '<li><a href="#" onClick="Resetpassword(\'' + rs3["Id"] + '\')">Reset Password</a></li>';
                                            }
                                        }
                                        else if (value.Name == 'Add Sub Office' || value.Name == 'Add Additional EFIN') {
                                            if (_addsuboffice && (rs3["IsActivationCompleted"] == 'true' || rs3["IsActivationCompleted"] == 'True' || rs3["IsActivationCompleted"] == true))
                                                if (rs3.EMPPassword)
                                                content2 += '<li><a href="/SubSiteOfficeConfiguration/CreateSubSiteInfo?ParentId=' + rs3["Id"] + '" target="_blank">' + value.Name + '</a></li>';
                                        }
                                        else if (value.Name == 'Activate Account' && rs3["EntityId"] == $('#Entity_SO').val() && (rs3["IsActivationCompleted"] != 'true' && rs3["IsActivationCompleted"] != 'True' && rs3["IsActivationCompleted"] != true)) {
                                            content2 += '<li><a href="#" onClick="ActiveAccount(\'' + rs3["Id"] + '\')">Activate Account</a></li>';
                                        } else if (value.Name == 'View Archive') {

                                            if (_archiveInfo) {
                                                content2 += '<li><a href="/Archive/SubSite?Id=' + rs3["Id"] + '&ParentId=' + rs2["ParentId"] + '&entitydisplayid=' + rs3["BaseEntityId"] + '&entityid=' + rs3["EntityId"] + '&ptype=config" target="_blank"> View Archive </a>';
                                            }
                                        }
                                    }
                                })
                                if (content2 != '')
                                    content2 += '</ul></div>';

                                row_tr3.append($("<td/>").html(content2));


                                //row_tr2.append($("<td/>").html('<div class="btn-group dropleft" onclick=toggleopen(this)><button class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Actions <span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu"><li><a href="#" onClick="Resetpassword(\'' + rs2["Id"] + '\')">Reset Password</a></li></ul></div>'));
                            });
                            row_td3.append(table_sub3);
                        }


                        //row_tr2.append($("<td/>").html('<div class="btn-group dropleft" onclick=toggleopen(this)><button class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Actions <span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu"><li><a href="#" onClick="Resetpassword(\'' + rs2["Id"] + '\')">Reset Password</a></li></ul></div>'));
                    });
                    row_td2.append(table_sub2);
                }
                //}
            });
            row_td.append(table_sub);
            return table_sub;
        }

        function fnChildInfo(e) {

        }

        function toggleopen(e, Id) {
            //$(e).toggleClass('open');
            $('ul[id^="ul_"]').each(function (e) {
                if ($(this)[0].id == 'ul_' + Id)
                    $('#ul_' + Id).toggleClass('display');
                else
                    $(this).removeClass('display');
            })
            //$('#ul_' + Id).toggleClass('display');
        }

        function fnSubDatadisplay(id, e) {
            $('#' + id).toggle();
            $(e).toggleClass('fa-plus-square').toggleClass('fa-minus-square');
        }

    </script>
}
<script type="text/javascript">
    $(document).ready(function () {

        if ($('#entityid').val() == $('#Entity_uTax').val()) {
            setTimeout(function () {
                $('.vmenu').addClass('allcust-menu');
            })
        }
        else {
            //GetCustomerInfomationForMainOfficeVerification();
        }

        //if ($('#entityid').val() != $('#myentityid').val()) {
        //    $('#btn_edit').text('Edit');
        //}
        //else {
        //    fnVerifiedLinksStatus();
        //}

        GetRecentlyCreate();
        GetRecentlyUpdate();

        getMultiSelectStatus($('#StatusID'));
        $('#StatusID').multiselect({
            includeSelectAllOption: true,
            selectAllNumber: false,
            enableCaseInsensitiveFiltering: true,
            buttonWidth: '200px'
        });

        getMultiSelectSiteType($('#SiteTypeID'));
        $('#SiteTypeID').multiselect({
            includeSelectAllOption: true,
            selectAllNumber: false,
            enableCaseInsensitiveFiltering: true,
            buttonWidth: '200px'
        });

        getMultiSelectBankFilter($('#BankPartnerID'));
        $('#BankPartnerID').multiselect({
            includeSelectAllOption: true,
            selectAllNumber: false,
            enableCaseInsensitiveFiltering: true,
            buttonWidth: '200px'
        });

        getMultiSelectEnrollmentStatus($('#EnrollmentID'));
        $('#EnrollmentID').multiselect({
            includeSelectAllOption: true,
            selectAllNumber: false,
            enableCaseInsensitiveFiltering: true,
            buttonWidth: '200px'
        });

        getMultiSelectOnBoardingStatus($('#OnBoardStatusID'));
        $('#OnBoardStatusID').multiselect({
            includeSelectAllOption: true,
            selectAllNumber: false,
            enableCaseInsensitiveFiltering: true,
            buttonWidth: '200px'
        });

        setTimeout(function () {
            $('#myTable tr.sub').css('display', 'none');
            $('.fa-minus-square').addClass('fa-plus-square');
            $('.fa-plus-square').removeClass('fa-minus-square');
        })
    });

    function fnDisplayClearChild() {
        $.blockUI({ message: '<img src="../content/images/loading-img.gif"/>' });
        $('#txtSearch').val('');
        $('#StatusID').val(0).multiselect('refresh');
        $('#SiteTypeID').val(0).multiselect('refresh');
        $('#BankPartnerID').val(0).multiselect('refresh');
        $('#EnrollmentID').val(0).multiselect('refresh');
        $('#OnBoardStatusID').val(0).multiselect('refresh');
        var table = $('#myTable').DataTable();
        table.destroy();
        LoadGridData($('#UserId').val(), -1);
    }
</script>
<script type="text/javascript">
    $(document).ready(function () {

        $(".slide-toggle button.grid-srch").click(function () {
            $(".main-search").slideToggle();
        });

        $(".slide-toggle button.refresh").click(function () {
            $.blockUI({ message: '<img src="../content/images/loading-img.gif"/>' });
            if ($(".main-search").css('display') == 'block')
                $(".main-search").slideToggle();
        });

        $(".hover .hover-blk")
        .mouseover(function () {
            $(".hover").addClass("in");
        })
        .mouseout(function () {
            $(".hover").removeClass("in");
        });
        //GetLatestData($('#dvCreated'), $('#dvUpdated'));
    });

</script>
<style>
    /*td.test {
        background: url('../Content/images/plus.png') no-repeat center center !important;
        cursor: pointer;
    }*/

    /*tr.shown {
        background: url('../Content/images/minus.png') no-repeat center center !important;
    }*/
    .details-control a {
        cursor: pointer;
    }

    .customer-actions {
        position: relative;
    }

        .customer-actions .dropdown-toggle {
            padding: 5px;
            font-size: 11px;
            text-transform: capitalize;
        }

        .customer-actions .dropdown-menu {
            left: -85px;
            top: 35px;
        }

            .customer-actions .dropdown-menu.display {
                display: block;
            }

    .btn-group.dropleft button {
        font-size: 11px;
    }

    .side-navigation ul li a::before :first-child {
        content: "\f0c8" !important;
    }

    /*.side-navigation ul li a::before {
        content: none !important;
    }*/

    .checkbox input[type="checkbox"], label.checkbox-inline input[type="checkbox"] {
        height: auto;
        opacity: 1;
        overflow: visible;
        position: relative;
        z-index: 5;
        width: auto;
    }
</style>
@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")

<script>
    $(function () {

        var Entity_MOSubSite = $('#Entity_MOSubSite').val();
        var Entity_SVBSubSite = $('#Entity_SVBSubSite').val();
        var Entity_SOMESubSite = $('#Entity_SOMESubSite').val();

        var entityid = $('#entityid').val();
        var entitydisplayid = $('#entitydisplayid').val();

        if (entityid != $('#Entity_uTax').val()) {
            $('.sidebar').removeClass('customers-sidebar').addClass('col-md-3 padding-left-25');
            $('.main-content-blk').removeClass('customers-griid').addClass('col-md-9');
        }
        getPermissions();
        getSitemap($('#divmenu'));

        if (entitydisplayid == $('#BaseEntity_AE').val() || entitydisplayid == $('#BaseEntity_AESS').val()) {
            getSubSiteConfigStatus();
        } else {
            getConfigStatus();
        }

        if ($('#ActiveMyAccountStatus').val() == 1 || $('#ActiveMyAccountStatus').val() == '1') {
            $('#spanSaveNext').hide();
        }
        else {
            $('#spanSaveNext').show();
        }

        //if ($('#ActiveMyAccountStatus').val() == '1' || $('#ActiveMyAccountStatus').val() == 1) {
        //    var sitemapid = $('#formid').attr('sitemapid');
        //    if (sitemapid == "60025459-7568-4a77-b152-f81904aaaa63") {
        //        $('#divSVBFeeReimNoteActive').show();
        //    }
        //}

    });
</script>