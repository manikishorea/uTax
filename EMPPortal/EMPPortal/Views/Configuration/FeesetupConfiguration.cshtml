@using EMPPortal.Filters;
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div id="error_bank" class="alert alert-danger" style="display: none;"></div>
<input type="hidden" id="formid" name="formid" value="active" formid="sitec81dddc4-4654-4775-a5cd-74efa99dfc90" sitemapid="c81dddc4-4654-4775-a5cd-74efa99dfc90" />
<input type="hidden" id="ID" name="ID" />
<div class="row" id="divFeeSetupConfigForm">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-body fee-blk">
                <h3>Default Fee Setup and Configuration</h3>

                <input type="hidden" id="hdnSubSiteActiveStatus" name="hdnSubSiteActiveStatus" value="0" />

                <input type="hidden" id="TotalBankProductFees" name="TotalBankProductFees" value="0" />
                <input type="hidden" id="TotaleFileFees" name="TotaleFileFees" value="0" />
                <div id="dvFees"></div>
                <h2>uTax & Transmitter Fees</h2>
                <div class="table-responsive cst-edit-tb col-md-6">
                    <table class="table table-striped table-hover table-bordered " id="tdFeeFixed"></table>
                </div>

                <div class="table-responsive cst-edit-tb col-md-6">
                    <table class="table table-striped table-hover table-bordered" id="tdFeeUser"></table>
                </div>
            </div>
        </div>


        <h2>Service Bureau Fees</h2>
        <div class="panel panel-default cst-panel">
            <div class="panel-body">
                <div class="multi-question">
                    <div class="question-block cst-radio-blk hide">
                        <div class="form-group">
                            <label>Will you be charging an Add-on Service Bureau Fee to any of your Sub-sites for Bank Products?</label>
                            <div class="radio" id="dvFirst">
                                <label>
                                    <input type="radio" name="sample1" id="rbService_BankProductYes" class="yesbox">
                                    Yes
                                </label>
                                <label>
                                    <input type="radio" name="sample1" id="rbService_BankProductNo" value="option1" class="nobox">
                                    No
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="question-block cst-radio-blk" id="subquestion_Service">
                        <div class="question-block hide">
                            <div class="form-group">
                                <label>Will this fee be the same for all Sub-sites?</label>
                                <div class="radio" id="dvSecound">
                                    <label>
                                        <input type="radio" name="sample2" id="rbService_SubSiteYes" class="yesbox">
                                        Yes
                                    </label>
                                    <label>
                                        <input type="radio" name="sample2" id="rbService_SubSiteNo" class="nobox">
                                        No
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label>What amount would you like to set as your default Add-on SVB Fee?  This fee can be changed on a per site basis during Sub-site activation. Please note, if you do not want to add-on to the SVB Fee, you must enter 0.</label>
                                <span class="cst-tooltip"><a class="ttip" id="ttip7e2f1f6b-5614-4294-b53e-f9c6b60ec0fb" style="display:none;" href="#" data-toggle="tooltip" data-placement="right" title="" data-original-title="Tooltip on right"><i class="fa fa-info" aria-hidden="true"></i></a></span>
                            </div>
                            <div class="col-md-12" id="divBankAddOn">
                            </div>
                            <div class="col-md-12" id="divBankAddOn_MSO">
                            </div>
                        </div>

                        <p style="color:red">
                            Please note: All fees listed here will be collected by uTax and will be paid to you according to the terms of your uTax License Agreement.  Default fees cannot be changed once enrollment is open, but can be changed on a per site basis during activation before tax season begins.
                        </p>
                    </div> <!-- sub-question-end -->

                    <div class="question-block cst-radio-blk">
                        <div class="form-group">
                            <label>Do you want to allow your Sub-sites to add on to the Service Bureau Fee during enrollment?</label>
                            <span class="cst-tooltip"><a class="ttip" id="ttip7e2f1f6b-5614-4294-b53e-f9c6b60ec0fd" style="display:none;" href="#" data-toggle="tooltip" data-placement="right" title="" data-original-title="Tooltip on right"><i class="fa fa-info" aria-hidden="true"></i></a></span>
                            <div class="radio" id="dvThird">
                                <label>
                                    <input type="radio" name="sample3" value="option3" id="rbService_duringEnrollingYes">
                                    Yes
                                </label>
                                <label>
                                    <input type="radio" name="sample3" value="option3" id="rbService_duringEnrollingNo">
                                    No
                                </label>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <h2>Transmitter Fees</h2>
        <div class="panel panel-default cst-panel">
            <div class="panel-body">

                <div class="multi-question">
                    <div class="question-block cst-radio-blk hide">
                        <div class="form-group">
                            <label>Will you be charging an Add-on Transmission Fee to any of your Sub-sites for Bank Products? </label>
                            <div class="radio" id="dvFifth">
                                <label>
                                    <input type="radio" name="sample4" class="yesbox" id="rbTrans_BankProductYes">
                                    Yes
                                </label>
                                <label>
                                    <input type="radio" name="sample4" value="option4" class="nobox" id="rbTrans_BankProductNo">
                                    No
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="question-block cst-radio-blk" id="subquestion_Trans">
                        <div class="question-block hide">
                            <div class="form-group">
                                <label>Will this fee be the same for all Sub-sites?</label>
                                <div class="radio" id="dvSixth">
                                    <label>
                                        <input type="radio" name="sample5" value="option5" class="yesbox" id="rbTrans_SubSiteYes" />
                                        Yes
                                    </label>
                                    <label>
                                        <input type="radio" name="sample5" value="option5" class="nobox" id="rbTrans_SubSiteNo" />
                                        No
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label>What amount would you like to set as your default Add-on Transmitter Fee?  This fee can be changed on a per site basis during Sub-site activation.  Please note, if you do not want to add-on to the Transmitter Fee, you must enter 0.</label>
                                <span class="cst-tooltip"><a class="ttip" id="ttipc556e391-27bd-46e7-9f64-52a97a291727" style="display:none;" href="#" data-toggle="tooltip" data-placement="right" title="" data-original-title="Tooltip on right"><i class="fa fa-info" aria-hidden="true"></i></a></span>
                            </div>
                            <div class="col-md-12" id="divBankAddOn_trns">
                            </div>
                            <div class="col-md-12" id="divBankAddOn_trns_MSO">
                            </div>
                        </div>

                        <p style="color:red;">
                            Please note:  All fees listed here will be collected by uTax and will be paid to you according to the terms of your uTax License Agreement.  Default fees cannot be changed once enrollment is open, but can be changed on a per site basis during activation before tax season begins.
                        </p>
                    </div> <!-- sub-question-end -->

                    <div class="question-block cst-radio-blk">
                        <div class="form-group">
                            <label>Do you want to allow your Sub-sites to add on to the Transmitter Fee during enrollment?</label>
                            <span class="cst-tooltip"><a class="ttip" id="ttip7e2f1f6b-5614-4294-b53e-f9c6b60ec0fe" style="display:none;" href="#" data-toggle="tooltip" data-placement="right" title="" data-original-title="Tooltip on right"><i class="fa fa-info" aria-hidden="true"></i></a></span>
                            <div class="radio" id="dvSeven">
                                <label>
                                    <input type="radio" name="sample6" value="option6" id="rbTrans_duringEnrollingYes">
                                    Yes
                                </label>
                                <label>
                                    <input type="radio" name="sample6" value="option6" id="rbTrans_duringEnrollingNo">
                                    No
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="clearfix"> </div>
        <div class="col-md-12">
            <a href="javascript:void(0)" class="btn btn-default btn-info" onclick="fnSaveFeeSetupConfig(0)">Save</a>
            <a href="javascript:void(0)" class="btn btn-default btn-info" id="btnMainFeeSetupSaveNext" onclick="fnSaveFeeSetupConfig(1)">Save & Next</a>
        </div>

    </div>
</div>

@section scripts {
    @Html.IncludeVersionedJs("/Scripts/app/SubsiteFeeSetupConfig.js")
    @Html.IncludeVersionedJs("/Scripts/app/MoSvbdetails.js")
}

<script>
    var cansubmit = true;
    var error = $('#error');
    error.html('');
    error.hide();

    $(document).ready(function () {
        $('#loading_main').hide();
        $('.btn.btn-default').hide();
        getTooltip();
        //getIsEnrollmentSubmit(); //Moved into
        SaveCustomerAssociateFee();
        getFeeReimbursementInformation();
        //getBankEnrollmentStatus();

        //  $('input[type=text]').removeAttr('readonly');
        //  $('input[type=radio]').removeAttr('disabled');
        //  $('.btn').removeAttr('disabled');

        $(".yesbox").each(function () {
            var isChecked = $(this).is(":checked");
            if (isChecked) {
                $(this).closest('.question-block').siblings(".sub-question").show();
            }
        });


        $(".yesbox").change(function () {
            var isChecked = $(this).is(":checked");
            if (isChecked) {
                $(this).closest('.question-block').siblings(".sub-question").show();
            }
        });


        $(".nobox").change(function () {
            var isChecked = $(this).is(":checked");
            if (isChecked) {
                $(this).closest('.question-block').siblings(".sub-question").hide();
            }
        });


        //var iretval = getIsSalesYearCheckBankDates();
        //var error_bank = $('#error_bank');
        //error_bank.html('');
        //error_bank.hide();
        //if (iretval == false || iretval == 'false' || iretval == 'False') {
        //    error_bank.show();
        //    error_bank.html('');
        //    error_bank.append('<p>The ability to update the Fees information is not available since the Cutoff date for the same is elapsed. Please contact the uTax support team. </p>');
        //    return false;
        //}
    });

    function fnFeeSetupSVBFee(e) {


        var TotalFeeAmount = $('#TotalBankProductFees').val();
        cansubmit = true
        error.html('');
        error.hide();
        $(e).removeClass("error_msg");

        var thisval = $(e).val();
        var regexp = /^\d+(\.\d{1,2})?$/; ///^\d+\.\d{1,2}$/;
        var result = regexp.test(thisval)


        if (result) {


            var mainfee = $(e).attr('mainfee');
            var subfee = $(e).attr('subfee');
            var maxfee = $(e).attr('maxfee');

            if (thisval != '' && thisval != null && thisval != undefined) {

                if (maxfee == '' || maxfee == null || maxfee == undefined) {
                    maxfee = 0;
                }

                if (subfee == '' || subfee == null || subfee == undefined) {
                    subfee = 0;
                }

                if (TotalFeeAmount == '' || TotalFeeAmount == null || TotalFeeAmount == undefined) {
                    TotalFeeAmount = 0;
                }

                TotalFeeAmount = Number(TotalFeeAmount) + Number(subfee);

                var AddOnFees = 0;
                if (Number(TotalFeeAmount) < Number(maxfee)) {
                    AddOnFees = Number(maxfee) - Number(TotalFeeAmount);
                }
                else {
                    AddOnFees = Number(TotalFeeAmount) - Number(maxfee);
                }

                $(e).removeClass("error_msg");
                if (Number(thisval) > Number(AddOnFees)) {
                    $(e).addClass("error_msg");
                    $(e).attr('title', 'Maximum possible for this bank is : $' + AddOnFees);
                    cansubmit = false;
                }
            }
        }
        else {
            $(e).removeClass("error_msg");
            $(e).addClass("error_msg");
            $(e).attr('title', 'Please provide the correct value.');
            cansubmit = false;
        }

        if (!cansubmit) {
            error.show();
            error.append('<p> Please correct the error(s). </p>');
            return false;
        }

    };

    function fnFeeSetupTRANSFee(e) {

        cansubmit = true
        error.html('');
        error.hide();
        $(e).removeClass("error_msg");

        var TotalFeeAmount = 0;// $('#TotaleFileFees').val();

        var thisval = $(e).val();
        var regexp = /^\d+(\.\d{1,2})?$/; ///^\d+\.\d{1,2}$/;
        var result = regexp.test(thisval)

        if (result) {
            var mainfee = $(e).attr('mainfee');
            var subfee = $(e).attr('subfee');
            var maxfee = $(e).attr('maxfee');

            if (thisval != '' && thisval != null && thisval != undefined) {


                if (subfee == '' || subfee == null || subfee == undefined) {
                    subfee = 0;
                }

                if (maxfee == '' || maxfee == null || maxfee == undefined) {
                    maxfee = 0;
                }

                if (TotalFeeAmount == '' || TotalFeeAmount == null || TotalFeeAmount == undefined) {
                    TotalFeeAmount = 0;
                }

                TotalFeeAmount = Number(TotalFeeAmount) + Number(subfee);

                var AddOnFees = 0;

                if (Number(TotalFeeAmount) < Number(maxfee)) {
                    AddOnFees = Number(maxfee) - Number(TotalFeeAmount);
                }
                else {
                    AddOnFees = Number(TotalFeeAmount) - Number(maxfee);
                }


                if (Number(thisval) > Number(AddOnFees)) {
                    $(e).addClass("error_msg");
                    $(e).attr('title', 'Maximum possible for this bank is : $' + AddOnFees);
                    cansubmit = false;
                }
            }
        } else {
            $(e).addClass("error_msg");
            $(e).attr('title', 'Please provide the correct value');
            cansubmit = false;
        }

        if (!cansubmit) {
            error.show();
            error.append('<p> Please correct the error(s). </p>');
            return false;
        }
    };

</script>